<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css"/>
        <title>Power Spinner Tool</title>
        <!-- checkbox part based on graphics from http://www.csscheckbox.com/download-upload.php?id=2707 -->
        <script>
            var spinner, my_spin_mode = 10;
            var spinner_default_value = 3;
            var spinner_last_nondefault = 3;
            function spinmode(i) {
                // I think the function will facilitate having multiple such objects
                my_spin_mode = i;
            }
            function update_spinner_checkbox() {
                var same = Number($('#spinner')[0].value) == spinner_default_value;
                if (same) {
                    $('#spinnercheckbox').prop('src', 'checkbox0.png');
                } else {
                    $('#spinnercheckbox').prop('src', 'checkbox1.png');
                }
                if (!same) {
                    spinner_last_nondefault = $('#spinner')[0].value;
                }
            }
            $(function() {
                $('#checkboxspinnermenu').menu();
                spinner = $('#spinner').spinner({
                    spin: function(event, ui) {
                        event.preventDefault();
                        if (event.which == 3) {
                            var menu = $('#checkboxspinnermenu').show().position({
                                my: 'left top',
                                at: 'right bottom',
                                of: this
                            });
                            $(document).one('click', function() {
                                menu.hide();
                            });
                        } else if (event.which == 1) {
                            var new_value = ui.value;
                            var old_value = Number($('#spinner')[0].value);
                            if (new_value > old_value) {
                                // increment
                                switch(my_spin_mode) {
                                    case 1:
                                        old_value *= 10;
                                        break;
                                    case 2:
                                        old_value *= Math.pow(10, 0.1);
                                        break;
                                    case 3:
                                        old_value *= Math.exp(1);
                                        break;
                                    case 4:
                                        old_value *= Math.exp(0.1);
                                        break;
                                    case 5:
                                        old_value *= 2;
                                        break;
                                    case 6:
                                        old_value *= Math.pow(2, 0.1);
                                        break;
                                    case 7:
                                        old_value += 1000;
                                        break;
                                    case 8:
                                        old_value += 100;
                                        break;
                                    case 9:
                                        old_value += 10;
                                        break;
                                    case 10:
                                        old_value += 1;
                                        break;
                                    case 11:
                                        old_value += 0.1;
                                        break;
                                    case 12:
                                        old_value += 0.01;
                                        break;
                                    case 13:
                                        old_value += 0.001;
                                        break;
                                }
                                $('#spinner')[0].value = old_value;
                            } else {
                                // decrement
                                switch(my_spin_mode) {
                                    case 1:
                                        old_value /= 10;
                                        break;
                                    case 2:
                                        old_value /= Math.pow(10, 0.1);
                                        break;
                                    case 3:
                                        old_value /= Math.exp(1);
                                        break;
                                    case 4:
                                        old_value /= Math.exp(0.1);
                                        break;
                                    case 5:
                                        old_value /= 2;
                                        break;
                                    case 6:
                                        old_value /= Math.pow(2, 0.1);
                                        break;
                                    case 7:
                                        old_value -= 1000;
                                        break;
                                    case 8:
                                        old_value -= 100;
                                        break;
                                    case 9:
                                        old_value -= 10;
                                        break;
                                    case 10:
                                        old_value -= 1;
                                        break;
                                    case 11:
                                        old_value -= 0.1;
                                        break;
                                    case 12:
                                        old_value -= 0.01;
                                        break;
                                    case 13:
                                        old_value -= 0.001;
                                        break;
                                }
                                $('#spinner')[0].value = old_value;
                            }                            
                        }
                        update_spinner_checkbox();
                    }
                });
                
                // add the checkbox
                $('#spinner').parent().prepend('&nbsp;<a><img src="checkbox0.png" id="spinnercheckbox" height="18px" width="18px" style="margin-bottom:-3px"/></a>');
                function prompt_to_update_default() {
                    if (Number($('#spinner')[0].value) == spinner_default_value) return;
                    $('#spinnerchangeconfirm').html('Permanently replace default value of ' + spinner_default_value + ' with ' + Number($('#spinner')[0].value) + '?');
                    $('#spinnerchangeconfirm').dialog({
                        resizable: false,
                        modal: true,
                        buttons: {
                            'Replace': function() {
                                replace_spinner_value();
                                $(this).dialog('close');
                            },
                            'Cancel': function() {
                                $(this).dialog('close');
                            }
                        }
                    });
                }
                function replace_spinner_value() {
                    spinner_default_value = Number($('#spinner')[0].value);
                    update_spinner_checkbox();
                }
                $('#spinnercheckbox').parent().bind('contextmenu', function(event) {
                    event.preventDefault();
                    prompt_to_update_default();
                });
                //$('#spinnercheckbox').bind('contextmenu', function() {return false;});
                $('#spinnercheckbox').parent().click(function(event) {
                    if (event.which == 1) {
                        if ($('#spinner')[0].value == spinner_default_value) {
                            $('#spinner')[0].value = spinner_last_nondefault;
                        } else {
                            spinner_last_nondefault = $('#spinner')[0].value;
                            $('#spinner')[0].value = spinner_default_value;
                        }
                    } else {
                        if (event.which == 3) {
                            console.log('should never get here');
                            prompt_to_update_default();
                        }
                    }
                    update_spinner_checkbox();
                });
                $('#spinner').on('keydown', update_spinner_checkbox);
                $('#spinner').on('keyup', update_spinner_checkbox);
                
                // disable context menu on spinner buttons and checkboxspinnermenu
                $('.ui-spinner-button').bind('contextmenu', function() {return false;});
                $('#checkboxspinnermenu').bind('contextmenu', function() {return false;});
            });
        </script>
    </head>
    <body>
        <h1>
            Power Spinner Tool
        </h1>
        
        <p>
            The checkbox indicates if a non-default value is shown. Click the checkbox to toggle between a current value and the default.
            Right-click the checkbox to change the default value. Right-click on the spinner arrows to change their step methods.
        </p>
        
        <p>
            <label for="spinner">Select a value:</label>
            <input id="spinner" name="value" value='3' style='text-align: right'></input>
        </p>
        
        <ul style='display:none; width: 6em;' id='checkboxspinnermenu'>
            <!-- no idea what the first one does <li>Res</li> -->
            <li><a onclick="spinmode(1)">* 10</a></li>
            <li><a onclick="spinmode(2)">* 10^.1</a></li>
            <li><a onclick="spinmode(3)">* e</a></li>
            <li><a onclick="spinmode(4)">* e^.1</a></li>
            <li><a onclick="spinmode(5)">* 2</a></li>
            <li><a onclick="spinmode(6)">* 2^.1</a></li>
            <li><a onclick="spinmode(7)">+ 1000</a></li>
            <li><a onclick="spinmode(8)">+ 100</a></li>
            <li><a onclick="spinmode(9)">+ 10</a></li>
            <li><a onclick="spinmode(10)">+ 1</a></li>
            <li><a onclick="spinmode(11)">+ 0.1</a></li>
            <li><a onclick="spinmode(12)">+ 0.01</a></li>
            <li><a onclick="spinmode(13)">+ 0.001</a></li>
        </ul>
        
        <div style='display: none;' id='spinnerchangeconfirm'>
            Permanently replace default value WHATEVER with WHATEVER?        
        </div>
            
    </body>
</html>
